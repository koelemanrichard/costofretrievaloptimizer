# Failure & Regression Log

**Purpose:** This document is a system of record for tracking critical failures, their root causes, and the steps taken to resolve them. It serves as our institutional memory to prevent repeating mistakes.

---

### **Incident #1: Critical Crash on "Generate Brief" (React Error #31)**

-   **Failure Count:** 23
-   **Resolution:** **SUCCESS.**
    *   **Root Cause:** Malformed nested objects from AI responses and unsafe rendering of objects as React children.
    *   **Fix:**
        1.  Implemented deep, recursive schema validation in `AIResponseSanitizer`.
        2.  Created `utils/parsers.ts` to sanitize all data entering from the DB.
        3.  **Nuclear Option:** Removed `react-markdown` library and replaced it with safe native text rendering (`whitespace-pre-wrap`) in all modals.

---

### **Incident #2: Content Briefs Not Persisting (Data Loss)**

-   **Failure Count:** 1
-   **User Report:** "looks like the contentbrief doesn't persist when I reload the topical map".
-   **Root Cause:**
    1.  The Supabase `content_briefs` table schema was missing columns for the rich data generated by the AI (`outline`, `serp_analysis`, etc.).
    2.  The `BriefReviewModal` only updated local state and did not trigger a database `insert/update`.
-   **Resolution:** **SUCCESS.**
    *   **Fix:** Updated database schema via SQL migration to add missing columns.
    *   **Fix:** Updated `database.types.ts` and `parsers.ts` to handle the new fields.
    *   **Fix:** Implemented `upsert` logic in `BriefReviewModal` to save data to Supabase before updating local state.

---
