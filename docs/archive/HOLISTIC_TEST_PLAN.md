# Holistic SEO Workbench: Test Plan

This document is the single source of truth for Quality Assurance. Every change must be validated against this full test suite before being submitted. This is a living document and will be updated as new features are added.

---

## 1. UI & Component Rendering Tests

These tests verify that the core UI components render correctly with all their required elements.

| Test Case ID | Feature                     | Given                               | When                                                                | Then                                                                                                                                                                                                 |
| :----------- | :-------------------------- | :---------------------------------- | :------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1.1**      | **Settings Modal UI**       | The user is logged in.              | The user clicks the "Settings" button.                              | The modal must appear and contain tabs for "AI Providers" and "SERP & Services". It must render a labeled input field for **every single setting** listed in `CONFIG_SCHEMA.md`.                  |
| **1.2**      | **Business Info Form UI**   | A new topical map is created.       | The `BusinessInfoForm` is displayed.                                | The form must render all required strategic input fields (Seed Keyword, Value Prop, etc.) AND the "AI Configuration" section, pre-filled with the user's global defaults.                   |
| **1.3**      | **Map Selection Screen UI** | A project with existing maps is loaded. | The `MapSelectionScreen` is displayed.                              | The screen must use the correct multi-column layout, displaying the action cards on the left and a scrollable list of all existing topical maps for that project on the right.                    |

---

## 2. Data Flow & State Management Tests

These tests verify that data flows correctly through the application, from user input to AI services to the database.

| Test Case ID | Feature                                  | Given                                                              | When                                                                    | Then                                                                                                                                                                                                                                                        |
| :----------- | :--------------------------------------- | :----------------------------------------------------------------- | :---------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **2.1**      | **Dynamic AI Model Fetching**            | The user is in the `SettingsModal`.                                  | The user selects an AI provider and enters a valid API key.             | The "AI Model" dropdown must become populated with the correct, up-to-date list of models for that provider. For OpenRouter, this must be a **live, dynamic API call**.                                                                                          |
| **2.2**      | **Data Integrity on Map Creation**       | The user has filled out the `BusinessInfoForm`.                      | The user clicks "Save & Start Pillar Definition".                       | The `business_info` JSON saved to the `topical_maps` table must contain ONLY the strategic data from the form. It must **NOT** contain any sensitive API keys.                                                                                             |
| **2.3**      | **AI Call Context & API Key Flow**       | The user is in the `PillarDefinitionWizard`.                         | The wizard makes an AI call to `suggestCentralEntityCandidates`.        | The AI service must receive a complete configuration object that correctly merges the map's strategic data with the user's global API key from `appState`. The "API key not configured" error must **NOT** occur.                                            |
| **2.4**      | **AI Provider Key Validation (CRUD)**    | The user is in the `SettingsModal`.                                  | The user interacts with the API key fields in the "AI Providers" tab. | **Read:** The modal correctly loads and displays the user's saved, decrypted API keys. <br/> **Test:** The "Test Key" button correctly validates the key and shows success/failure. <br/> **Create/Update/Delete:** Saving new, changed, or empty keys works correctly. |

---

## 3. End-to-End User Workflows

These tests validate the application's core user journeys from start to finish.

| Test Case ID | Workflow                               | Given                                                                    | When                                                                                             | Then                                                                                                                                                                                                                                                                                                                                                                                              |
| :----------- | :------------------------------------- | :----------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **3.1**      | **Full Project & Map Loading**         | The user is logged in and has existing projects and maps in the database. | 1. The application loads. <br/> 2. The user clicks "Load Project" on an existing project. | 1. The `ProjectSelectionScreen` must populate with all of the user's projects. <br/> 2. The `MapSelectionScreen` must populate with all of that project's topical maps.                                                                                                                                                            |
| **3.2**      | **Full "New Map" Creation**            | The user has loaded a project.                                           | The user completes the entire "New Map" wizard from start to finish.                             | The application must successfully: <br/> 1. Save the Business Info. <br/> 2. Save the SEO Pillars. <br/> 3. Save the EAVs. <br/> 4. Save the Competitors. <br/> 5. Trigger the `generateInitialTopicalMap` AI call. <br/> 6. Save the resulting topics to the database. <br/> 7. Transition the user to the `ProjectDashboard` to view the new map. |
| **3.3**      | **Full "Generate Brief" Workflow**     | The user is on the dashboard with a map where prerequisites are met.     | The user clicks the "Generate Brief" icon, selects a response code, and confirms.                | The `ResponseCodeSelectionModal` appears. After confirming, the AI generates the brief, the brief is saved to the database, the state is updated, and the `ContentBriefModal` opens to display the new brief. The application must **NOT** crash.                               |

---

## 4. Error Handling & Resilience

These tests validate the application's stability and user feedback when things go wrong.

| Test Case ID | Workflow                               | Given                                                                    | When                                                                                             | Then                                                                                                                                                                                                                                                                                                                                                                                              |
| :----------- | :------------------------------------- | :----------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **4.1**      | **AI Service Call Failure**            | The user is on the dashboard.                                            | An AI service call (e.g., `generateContentBrief`) fails due to an invalid API key or a server error. | The application must **NOT** crash or navigate away. A user-friendly error message must be displayed in the designated error banner. The UI must remain responsive, allowing the user to try again or perform other actions.                                                                                                       |
| **4.2**      | **Component Crash Resilience**         | An unexpected error is thrown during a component's render cycle or event handler. | The user performs an action that triggers the error.                                             | The application must **NOT** crash back to a previous screen. Ideally, an Error Boundary component would catch the error and display a localized message, allowing the rest of the application to remain functional. At minimum, a global error must be caught and displayed without losing the user's main context. |
| **4.3**      | **Prerequisite Check Feedback**        | A user is on the dashboard, but the Knowledge Graph has not been generated. | The user clicks the "Generate Brief" icon on a topic.                                            | The `ResponseCodeSelectionModal` should **NOT** open. Instead, a specific error message must be displayed, clearly explaining what the user needs to do first (e.g., "Please run 'Analyze Domain' before generating a brief."). The application state must remain stable. |