# Holistic SEO Workbench: Test Plan

This document is the single source of truth for Quality Assurance. Every change must be validated against this full test suite before being submitted. This is a living document and will be updated as new features are added.

---

## 1. UI & Component Rendering Tests

These tests verify that the core UI components render correctly with all their required elements.

| Test Case ID | Feature                     | Given                               | When                                                                | Then                                                                                                                                                                                                 |
| :----------- | :-------------------------- | :---------------------------------- | :------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1.1**      | **Settings Modal UI**       | The user is logged in.              | The user clicks the "Settings" button.                              | The modal must appear and contain tabs for "AI Providers" and "SERP & Services". It must render a labeled input field for **every single setting** listed in `CONFIG_SCHEMA.md`.                  |
| **1.2**      | **Business Info Form UI**   | A new topical map is created.       | The `BusinessInfoForm` is displayed.                                | The form must render all required strategic input fields (Seed Keyword, Value Prop, etc.) AND the "AI Configuration" section, pre-filled with the user's global defaults.                   |
| **1.3**      | **Map Selection Screen UI** | A project with existing maps is loaded. | The `MapSelectionScreen` is displayed.                              | The screen must use the correct multi-column layout, displaying the action cards on the left and a scrollable list of all existing topical maps for that project on the right.                    |

---

## 2. Data Flow & State Management Tests

These tests verify that data flows correctly through the application, from user input to AI services to the database.

| Test Case ID | Feature                                  | Given                                                              | When                                                                    | Then                                                                                                                                                                                                                                                        |
| :----------- | :--------------------------------------- | :----------------------------------------------------------------- | :---------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **2.1**      | **Dynamic AI Model Fetching**            | The user is in the `SettingsModal`.                                  | The user selects an AI provider and enters a valid API key.             | The "AI Model" dropdown must become populated with the correct, up-to-date list of models for that provider. For OpenRouter, this must be a **live, dynamic API call**.                                                                                          |
| **2.2**      | **Data Integrity on Map Creation**       | The user has filled out the `BusinessInfoForm`.                      | The user clicks "Save & Start Pillar Definition".                       | The `business_info` JSON saved to the `topical_maps` table must contain ONLY the strategic data from the form. It must **NOT** contain any sensitive API keys.                                                                                             |
| **2.3**      | **AI Call Context & API Key Flow**       | The user is in the `PillarDefinitionWizard`.                         | The wizard makes an AI call to `suggestCentralEntityCandidates`.        | The AI service must receive a complete configuration object that correctly merges the map's strategic data with the user's global API key from `appState`. The "API key not configured" error must **NOT** occur.                                            |
| **2.4**      | **AI Provider Key Validation (CRUD)**    | The user is in the `SettingsModal`.                                  | The user interacts with the API key fields in the "AI Providers" tab. | **Read:** The modal correctly loads and displays the user's saved, decrypted API keys. <br/> **Test:** The "Test Key" button correctly validates the key and shows success/failure. <br/> **Create/Update/Delete:** Saving new, changed, or empty keys works correctly. |

---

## 3. End-to-End User Workflows

These tests validate the application's core user journeys from start to finish.

| Test Case ID | Workflow                               | Given                                                                    | When                                                                                             | Then                                                                                                                                                                                                                                                                                                                                                                                              |
| :----------- | :------------------------------------- | :----------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **3.1**      | **Full Project & Map Loading**         | The user is logged in and has existing projects and maps in the database. | 1. The application loads. <br/> 2. The user clicks "Load Project" on an existing project. | 1. The `ProjectSelectionScreen` must populate with all of the user's projects. <br/> 2. The `MapSelectionScreen` must populate with all of that project's topical maps.                                                                                                                                                            |
| **3.2**      | **Full "New Map" Creation**            | The user has loaded a project.                                           | The user completes the entire "New Map" wizard from start to finish.                             | The application must successfully: <br/> 1. Save the Business Info. <br/> 2. Save the SEO Pillars. <br/> 3. Save the EAVs. <br/> 4. Save the Competitors. <br/> 5. Trigger the `generateInitialTopicalMap` AI call. <br/> 6. Save the resulting topics to the database. <br/> 7. Transition the user to the `ProjectDashboard` to view the new map. |

---

## 4. UI & Button Interaction Tests

These tests ensure that all primary user action buttons are functional and provide correct feedback.

| Test Case ID | Feature                                  | Given                                                            | When                                                                | Then                                                                                                                                                                                                                                         |
| :----------- | :--------------------------------------- | :--------------------------------------------------------------- | :------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **4.1**      | **"Save & Start Pillar Def" Button**     | The user has filled out the `BusinessInfoForm`.                  | The user clicks the "Save & Start Pillar Definition" button.        | The button must show a loading state. The `handleBusinessInfoComplete` function must be called. The data must be saved to the database. The application must transition to the `PillarDefinitionWizard`.                                                   |
| **4.2**      | **"Finalize & Generate Map" Button**     | The user is on the final step of the wizard (`CompetitorRefinementWizard`). | The user clicks the "Finalize & Generate Map" button.             | The button must show a loading state. The `handleFinalizeCompetitors` function must be called. The AI must be prompted to generate topics. The topics must be saved to the database. The application must transition to the `ProjectDashboard`.           |
| **4.3**      | **"Generate Brief" Button/Icon**         | The user is on the `ProjectDashboard`.                           | The user clicks the "Generate Brief" icon on a topic.               | The `ResponseCodeSelectionModal` must appear. After selection and confirmation, the button must show a loading state, the AI must be called, the brief must be saved, and the topic's icon must update to show the brief is available.                   |
| **4.4**      | **"Save Settings" Button**               | The user has changed a value in the `SettingsModal`.             | The user clicks the "Save Settings" button.                         | The button must show a loading state. The `update-settings` function must be called. On success, the modal must close and a notification must appear. When reopened, the new settings must be present.                                                    |

---

## 5. Application Lifecycle & State

These tests validate the application's behavior on startup and its resilience to common configuration issues.

| Test Case ID | Description                                  | Given                                                                    | When                                                                    | Then                                                                                                                                                                                                                                                                                                       |
| :----------- | :------------------------------------------- | :----------------------------------------------------------------------- | :---------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **5.1 (Revised)** | **Critical Path:** Global Settings Hydration on App Load | A user with previously saved API keys is logged in.                      | The application first loads, and the user's session is confirmed.       | **1. Immediate Fetch:** The application must *immediately* and *automatically* call the `get-settings` Supabase function. <br/> **2. State Update:** The returned settings must be successfully populated into the global `appState`. <br/> **3. Downstream Verification:** When the user navigates to the `BusinessInfoForm`, the AI provider dropdown *must* be correctly pre-selected based on the hydrated global state. |
| **5.2**      | App Resilience to Missing Server Secrets     | A user is logged in, but the `ENCRYPTION_SECRET` is not set on the server. | The application loads and attempts to fetch settings.                   | The application must **not** crash. The `get-settings` function must return a specific, structured error. The frontend must catch this error and display a clear, user-friendly message explaining the exact problem (e.g., "Server configuration error: ENCRYPTION_SECRET is not set...").                             |